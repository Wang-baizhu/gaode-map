(function (global) {
    'use strict';

    function createRoadSyntaxInitialState(ROAD_SYNTAX_CONST) {
        const syntaxConst = ROAD_SYNTAX_CONST || {};
        const switchTargetMs = Number(syntaxConst.SWITCH_TARGET_MS);
        const prebuildDeadlineMs = Number(syntaxConst.PREBUILD_DEADLINE_MS);
        const nodeMinZoom = Number(syntaxConst.CONNECTIVITY_NODE_MIN_ZOOM);

        return {
            isComputingRoadSyntax: false,
            roadSyntaxStatus: '',
            roadSyntaxPerformanceProfile: 'unbounded',
            roadSyntaxActiveEdgeCap: null,
            roadSyntaxDepthmapColorScale: 'axmanesque',
            roadSyntaxDisplayBlue: 0.0,
            roadSyntaxDisplayRed: 1.0,
            roadSyntaxSwitchSamples: [],
            roadSyntaxSwitchLastMs: 0,
            roadSyntaxSwitchP50Ms: 0,
            roadSyntaxSwitchP95Ms: 0,
            roadSyntaxSwitchTargetMs: Number.isFinite(switchTargetMs) ? switchTargetMs : 120,
            roadSyntaxSwitchStatsText: '',
            roadSyntaxSwitchPath: '',
            roadSyntaxSwitchInProgress: false,
            roadSyntaxSwitchQueuedLayerKey: '',
            roadSyntaxSwitchLastAt: 0,
            roadSyntaxSwitchCooldownMs: 80,
            roadSyntaxSwitchThrottleTimer: null,
            roadSyntaxStyleApplyToken: 0,

            roadSyntaxPolylines: [],
            roadSyntaxPolylineItems: [],
            roadSyntaxRenderMode: 'bucket_pool',
            roadSyntaxStyleBucketColorStep: 24,
            roadSyntaxStyleBucketWeightStep: 0.5,
            roadSyntaxStyleBucketOpacityStep: 0.08,
            roadSyntaxLayerPool: {},
            roadSyntaxLayerStyleCache: {},
            roadSyntaxActiveLayerKey: '',
            roadSyntaxActiveLayerVariant: 'full',
            roadSyntaxLayerLodCap: 180,
            roadSyntaxLayerLodIndexCache: {},
            roadSyntaxPoolWarmToken: 0,
            roadSyntaxSourceFingerprint: '',
            roadSyntaxPoolRadiusLabel: '',
            roadSyntaxLayerBuildState: {},
            roadSyntaxLayerBuildQueue: [],
            roadSyntaxLayerBuildRunning: false,
            roadSyntaxLayerBuildToken: 0,
            roadSyntaxLayerSwitchToken: 0,
            roadSyntaxPendingLayerKey: '',
            roadSyntaxPoolInitRunning: false,
            roadSyntaxPoolReady: false,
            roadSyntaxPoolDegraded: false,
            roadSyntaxPoolInitTotal: 0,
            roadSyntaxPoolInitDone: 0,
            roadSyntaxPrebuildDeadlineMs: Number.isFinite(prebuildDeadlineMs) ? prebuildDeadlineMs : 120000,
            roadSyntaxEnableHeavyPrewarm: false,
            roadSyntaxPrewarmToken: 0,
            roadSyntaxLayerReadyMap: {},
            roadSyntaxConnectivityReuseLayerKey: '',

            roadSyntaxNodeBuildToken: 0,
            roadSyntaxNodeBuildRunning: false,
            roadSyntaxNodeSourceFingerprint: '',
            roadSyntaxConnectivityNodeMinZoom: Number.isFinite(nodeMinZoom) ? nodeMinZoom : 15,
            roadSyntaxZoomListener: null,
            roadSyntaxZoomStartListener: null,
            roadSyntaxMoveStartListener: null,
            roadSyntaxMoveEndListener: null,
            roadSyntaxMapInteracting: false,
            roadSyntaxNodeMarkers: [],
            roadSyntaxStyleUpdateToken: 0,
            roadSyntaxLastStyleKey: '',
            roadSyntaxRequestToken: 0,
            roadSyntaxRoadFeatures: [],
            roadSyntaxNodes: [],
            roadSyntaxDiagnostics: null,
            roadSyntaxScatterPointsCache: [],
            roadSyntaxSkeletonOnly: false,
            roadSyntaxLegendModel: null,
            roadSyntaxScatterChart: null,
            roadSyntaxScatterRenderTimer: null,
            roadSyntaxUseArcgisWebgl: true,
            roadSyntaxStrictWebglOnly: true,
            roadSyntaxWebglPayload: null,
            roadSyntaxWebglActive: false,
            roadSyntaxWebglStatus: '',
            roadSyntaxLocaContainer: null,
            roadSyntaxLocaLineLayer: null,

            roadSyntaxMainTab: 'params',
            roadSyntaxTabs: [
                { value: 'params', label: '参数' },
                { value: 'connectivity', label: '连接度' },
                { value: 'control', label: '控制值' },
                { value: 'depth', label: '深度值' },
                { value: 'choice', label: '选择度' },
                { value: 'integration', label: '整合度' },
                { value: 'intelligibility', label: '可理解度' },
            ],
            roadSyntaxSummary: null,
            roadSyntaxMode: 'walking',
            roadSyntaxMetric: 'connectivity',
            roadSyntaxLastMetricTab: 'connectivity',
            roadSyntaxRadiusLabel: 'global',
            roadSyntaxStatusCopyHint: '',
            roadSyntaxDisplaySuspended: false,
            // Candidate visibility set computed from viewport/LOD.
            roadSyntaxTargetVisibleLineSet: {},
            // Actually applied visibility state on map writes.
            roadSyntaxAppliedVisibleLineSet: {},
            roadSyntaxOverlayCommitToken: 0,
            roadSyntaxOverlayLastCommitPath: '',
            roadSyntaxOverlayLastCommitReason: '',

            roadSyntaxViewportLazyEnabled: true,
            roadSyntaxDisableViewportToggle: false,
            roadSyntaxVisibleIndexCacheKey: '',
            roadSyntaxVisibleIndexCacheList: [],
            roadSyntaxViewportRefreshRaf: null,
            roadSyntaxViewportRefreshTimer: null,
            roadSyntaxViewportRefreshToken: 0,
            roadSyntaxNodeRefreshTimer: null,
            roadSyntaxRefineDelayMs: 150,
            roadSyntaxInteractionLowFidelity: false,
            roadSyntaxLodScoreCacheKey: '',
            roadSyntaxLodScoreList: [],
            roadSyntaxInteractionStride: 3,
            roadSyntaxCurrentStride: 1,

            roadSyntaxMapWriteQueue: null,
            roadSyntaxMapWriteQueuePending: 0,
            roadSyntaxMapWriteQueueMaxTasksPerFrame: 2,
        };
    }

    global.createRoadSyntaxInitialState = createRoadSyntaxInitialState;
}(window));

| 模块层级 | 核心技术库     | 功能                                                                                          |
| -------- | -------------- | --------------------------------------------------------------------------------------------- |
| 边界定义 | Valhalla       | 以项目为原点，生成一个不规则的 15 分钟等时圈多边形，确定后续分析的裁剪边界。                  |
| 内部单元 | 地块 + H3      | 地块：整体结构与缺失判断；H3：热力图、地块内部结构、邻域分析（后端计算单元）。                |
| 空间计算 | GeoPandas      | 1. 用等时圈裁剪地块与 H3 网格；2. POI 同时落位到地块与 H3 格子。                               |
| 指标计算 | Pandas + SciPy | 地块：POI 类型占比、香农熵、缺失类型判定；H3：密度、局部熵、邻域指标。                         |
| 结果汇总 | GeoPandas      | 地块直接展示整体指标；H3 结果用于热力图与结构/邻域分析，不再强制汇总到地块。                   |
| 可视化   | AMap / ECharts | 地块着色展示占比/熵/缺失类型；H3 网格热力图展示密度/结构；支持切换视图用于对比与调试。          |


第一阶段：确定研究范围 (Valhalla)
目标：获取项目周边的真实步行覆盖区（等时圈）。

第二阶段：准备地块数据 (GeoPandas)
目标：获取地块边界（规划/自然地块），并裁剪到等时圈内，作为整体结构分析单元。

第三阶段：构建内部微观网格 (H3 + GeoPandas)
目标：在研究区域内构建 H3 网格（如 res=9，边长约 170m）。  
清洗：将生成的网格转换为 GeoDataFrame，确保网格完全位于等时圈内部或与其相交。

第四阶段：POI 落位 (Spatial Join)
目标：POI 同时对照地块与 H3 格子。
空间连接：
- 地块：gpd.sjoin(parcels, pois, predicate='contains')
- H3：gpd.sjoin(grids, pois, predicate='contains')

第五阶段：地块级指标 (Pandas + SciPy)
目标：分析整体 POI 结构与缺失项，用于“哪里缺什么”的判断。
- 计算地块内 POI 类型占比
- 计算香农熵（混合度）
- 结合目标类型清单判定缺失类型

第六阶段：H3 结构与邻域指标 (Pandas + SciPy)
目标：地块内部结构与邻域关系，用于热力图与空间分析。
- 计算 H3 密度、局部熵
- 计算邻域指标（如邻域平均、空间自相关）

第七阶段：空间结构分析与展示（AMap + ECharts）
目标：回答“哪里缺什么”，同时展示地块内部结构与热力分布。  
展示方式：
- 地块视图：占比/熵/缺失类型着色
- H3 视图：密度/局部熵热力图与邻域结果
- 提供切换开关，便于对比/调试
